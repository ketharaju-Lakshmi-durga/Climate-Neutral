<!DOCTYPE html>
<html>

<head>
    <title>Results</title>
    <!-- Include Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1, h2 {
            text-align: center;
        }

        .chart-container {
            width: 40%;
            height: 40%;
            margin: 20px;
            display: inline-block;
        }
        table {
            width: 80%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            opacity: 0;
            animation: fadeIn 1s forwards;
            margin:auto;
            
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th ,td{
            background-color: rgb(54, 191, 222);
            text-align: center;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tr:hover {
            background-color: #ddd;
        }

    </style>
</head>

<body>
    <h1>Results</h1>

    <!-- Container for the Total Emissions chart -->
    <div class="chart-container">
        <canvas id="totalEmissionsChart"></canvas>
    </div>

    <!-- Container for the Emissions Intensity chart -->
    <div class="chart-container">
        <canvas id="emissionsIntensityChart"></canvas>
    </div>

    <!-- Container for the Avg Emissions Intensity Fleet chart -->
    <div class="chart-container">
        <canvas id="avgEmissionsIntensityFleetChart"></canvas>
    </div>
<div class="actionsavings">
    <h1>Action Savings</h1>
    <table id="entryTable" border="1">
        <thead>
            <tr>
                <th>Fleet Vehicle</th>
                <th>Action Applied</th>
                <th>Emission Savings<div>(TCO2e)</div></th>
                <th>% Savings</th>
                
            </tr>
        </thead>
        <tbody id="entryTableBody"></tbody>
    </table>

     </div>
    <script>
        // Retrieve the form data from localStorage
        var formData = JSON.parse(localStorage.getItem('formData'));
        var selectedOptions = JSON.parse(localStorage.getItem('selectedGreenOptions'));

        // Calculate emissions and build chart data
        var chartData = {
            labels: [],
            totalEmissions: [],
            emissionsIntensity: [],
            avgEmissionsIntensityFleet: []
        };

        for (var i = 0; i < formData.length; i++) {
            var annualFuelConsumption = formData[i].AnnualFuel;
            var annualVKT = formData[i].AnnualVKT;
            var fuelType = formData[i].FuelType;
            var vehicleQuantity = parseInt(formData[i].VehicleQuantity);
            console.log("Vehicle Quantity")
            console.log(vehicleQuantity)
        
            var fuelEmissionsCoefficient;

            // Determine fuel emissions coefficient based on fuel type
            switch (fuelType) {
                case 'Gasoline':
                    fuelEmissionsCoefficient = 2299;
                    break;
                case 'E10 Gasoline':
                    fuelEmissionsCoefficient = 2071;
                    break;
                case 'Diesel':
                    fuelEmissionsCoefficient = 2730;
                    break;
                // Add more cases for other fuel types if needed
                default:
                    fuelEmissionsCoefficient = 0; // Default value if fuel type not recognized
            }
            

            var annualEmissions = annualFuelConsumption * fuelEmissionsCoefficient;
            var emissionsIntensity = annualEmissions / annualVKT;
            var avgEmissionsIntensityFleet = emissionsIntensity * vehicleQuantity;

            // Add data to chartData
            chartData.labels.push(formData[i].Description);
            chartData.totalEmissions.push(annualEmissions);
            chartData.emissionsIntensity.push(emissionsIntensity);
            chartData.avgEmissionsIntensityFleet.push(avgEmissionsIntensityFleet);
        }

        // Display Total Emissions chart
        var totalEmissionsCtx = document.getElementById('totalEmissionsChart').getContext('2d');
        var totalEmissionsChart = new Chart(totalEmissionsCtx, {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: 'Total Emissions (gCO2e)',
                    data: chartData.totalEmissions,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Display Emissions Intensity chart
        var emissionsIntensityCtx = document.getElementById('emissionsIntensityChart').getContext('2d');
        var emissionsIntensityChart = new Chart(emissionsIntensityCtx, {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: 'Emissions Intensity (gCO2e/km)',
                    data: chartData.emissionsIntensity,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        

        
//AVERAGE EMISSIONS NOT WORKING




        // Display Avg Emissions Intensity Fleet chart
        var avgEmissionsIntensityFleetCtx = document.getElementById('avgEmissionsIntensityFleetChart').getContext('2d');
        var avgEmissionsIntensityFleetChart = new Chart(avgEmissionsIntensityFleetCtx, {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: 'Avg Emissions Intensity Fleet (gCO2e/km)',
                    data: chartData.avgEmissionsIntensityFleet,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
//Result Actions Savings
        for (var i = 0; i < formData.length; i++)
        {  //electrical efficiency for compact 2.9
            //electrical efficiency for truck 3.24
            province=formData[i].Province
            switch (province) {
                case 'Alberta':
                    provisionalEmissionsCoefficient = 540;
                    break;
                case 'British Columbia':
                    provisionalEmissionsCoefficient = 15;
                    break;
                case 'Ontario':
                    provisionalEmissionsCoefficient = 30;
                    break;
                case 'New Foundland & Labrador':
                    provisionalEmissionsCoefficient = 17;
                    break;
                case 'Prince Edaward Island':
                    provisionalEmissionsCoefficient = 300;
                    break;
                case 'Nova Scotia':
                    provisionalEmissionsCoefficient = 690;
                    break;
                case 'New Brunswick':
                    provisionalEmissionsCoefficient = 300;
                    break;
                case 'Quebec':
                    provisionalEmissionsCoefficient = 1.7;
                    break;
                case 'Manitoba':
                    provisionalEmissionsCoefficient = 2.0;
                    break;
                case 'Saskatchewan':
                    provisionalEmissionsCoefficient = 730;
                    break;
                default:
                provisionalEmissionsCoefficient = 30; ; // Default value 
            }
console.log(selectedOptions)

//if the light weight trcuks are replaced with Ev or Bio fuel light duty trucks
            if(selectedOptions[i]=='Replace w/ EV Light Duty Truck' || selectedOptions[i]=='Replace w/ Biofuel E85 Light Duty Truck')
{
    electricEfficiency=2.9*8.9
}
//for cars,downsized vehicles
else{
    electricEfficiency=3.24*8.29;
}
evEmissionIntensity=electricEfficiency*provisionalEmissionsCoefficient;
percentageSavings=(emissionsIntensity-evEmissionIntensity)/emissionsIntensity
percentageSavings=percentageSavings*100
console.log(emissionsIntensity)
console.log(percentageSavings)
totalEmissionSavings=(percentageSavings*annualEmissions)/100;
            var fleetdetail=''
        fleetdetail='<p>'+formData[i].Description+' - '+formData[i].FuelType+' - '+formData[i].Year+' - '+formData[i].Make+' - '+formData[i].Model+'</p>'

            var rowData = {
    Fleetvehicle:fleetdetail,
    Actionapplied: selectedOptions[i],
    EmissionSavings:totalEmissionSavings,
    PercentageSavings:percentageSavings,
   
  };

  // Get table body
  var tableBody = document.getElementById('entryTableBody');

  // Create a new row
  var newRow = document.createElement('tr');

  // Populate the row with data
  newRow.innerHTML = `
    <td>${rowData.Fleetvehicle}</td>
    <td>${rowData.Actionapplied}</td>
    <td>${rowData.EmissionSavings}</td>
    <td>${rowData.PercentageSavings}</td>
  `;


  // Append the new row to the table body
  tableBody.appendChild(newRow);
}
</script>
        
    
</body>

</html>